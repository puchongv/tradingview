# เปรียบเทียบ Logic Python vs SQL

## ปัญหาที่เกิดขึ้น

### Python (Test 022) - คำนวนจาก 22 Sep
```
Entry Time     | PNL Change | Cumulative PNL
---------------|------------|---------------
22 Sep 00:00   | +50        | 50
22 Sep 01:00   | -50        | 0
22 Sep 02:00   | +50        | 50
...            | ...        | ...
30 Sep 23:00   | +50        | 2000
```

### SQL V2/V3 - คำนวนจาก ~2 Sep (NOW() - 30 days)
```
Entry Time     | PNL Change | Cumulative PNL
---------------|------------|---------------
02 Sep 00:00   | +50        | 50        ← เริ่มก่อน 20 วัน!
02 Sep 01:00   | -50        | 0
...            | ...        | ...
22 Sep 00:00   | +50        | 5000      ← ตรงนี้ควรเป็น 50!
...            | ...        | ...
30 Sep 23:00   | +50        | 12000     ← ตรงนี้ควรเป็น 2000!
```

## ผลกระทบต่อคะแนน

เนื่องจาก P1, P2, P3 ใน SQL **สูงกว่า** Python มาก:
- **M₁ = P1 - P2** จะได้ค่าต่างกัน
- **Acceleration = M₁ - M₂** จะได้ค่าต่างกัน
- **Score** จะได้ค่าต่างกัน!

## วิธีแก้ที่ถูกต้อง

### Option 1: ใช้ Relative PNL (แนะนำ) ✅
คำนวน PNL **เฉพาะช่วง 6 ชั่วโมงล่าสุด** แทนที่จะใช้ cumulative
```sql
-- P1 = PNL ในชั่วโมงล่าสุด (ไม่ใช่ cumulative)
-- P2 = PNL ในชั่วโมงก่อนหน้า
-- ...
```

### Option 2: Reset Cumulative PNL ทุกวัน
```sql
-- Reset cumulative PNL ที่ 00:00 ทุกวัน
-- ทำให้ PNL ไม่สูงเกินไป
```

### Option 3: Fix Base Date (ไม่แนะนำ)
```sql
-- Hard-code start_date
WHERE entry_time >= '2025-09-22 00:00:00'
-- แต่จะไม่ dynamic
```

## สรุป
SQL ตอนนี้คำนวน **cumulative PNL จากจุดเริ่มต้นที่ต่างกัน** ทำให้ค่า P1-P6 ต่างจาก Python!

