{
  "dashboard": {
    "name": "Binary Options Trading Pattern Analysis",
    "description": "Dashboard สำหรับวิเคราะห์ patterns ที่ส่งผลต่อ win rate",
    "charts": [
      {
        "id": "time_winrate_chart",
        "title": "Win Rate by Hour",
        "type": "line",
        "description": "แสดง win rate ตามชั่วโมง - Highlight ช่วงเวลา 02:00 (69.1%) และ 17:00 (23.9%)",
        "query": {
          "select": [
            "EXTRACT(HOUR FROM entry_time) as hour",
            "AVG(CASE WHEN result_60min = 'WIN' THEN 1 ELSE 0 END) as win_rate",
            "COUNT(*) as total_trades"
          ],
          "from": "trading_signals",
          "group_by": "EXTRACT(HOUR FROM entry_time)",
          "order_by": "hour"
        },
        "visualization": {
          "x_axis": "hour",
          "y_axis": "win_rate",
          "color": "win_rate",
          "highlight_points": [
            {"hour": 2, "label": "Best Time (69.1%)"},
            {"hour": 17, "label": "Worst Time (23.9%)"}
          ]
        }
      },
      {
        "id": "volatility_analysis",
        "title": "Win Rate by Volatility Level",
        "type": "bar",
        "description": "แสดง win rate ตามระดับความผันผวน - Alert เมื่อ volatility level = 2 (0% win rate)",
        "query": {
          "select": [
            "volatility_level",
            "AVG(CASE WHEN result_60min = 'WIN' THEN 1 ELSE 0 END) as win_rate",
            "COUNT(*) as total_trades"
          ],
          "from": "trading_signals",
          "group_by": "volatility_level",
          "order_by": "volatility_level"
        },
        "visualization": {
          "x_axis": "volatility_level",
          "y_axis": "win_rate",
          "color": "win_rate",
          "alert_condition": "volatility_level = 2 AND win_rate < 0.1"
        }
      },
      {
        "id": "strategy_combination_performance",
        "title": "Strategy + Action Combination Performance",
        "type": "bar",
        "description": "แสดง win rate ของแต่ละ combination - Highlight combinations ที่ควรหลีกเลี่ยง",
        "query": {
          "select": [
            "CONCAT(strategy, ' + ', action) as combination",
            "AVG(CASE WHEN result_60min = 'WIN' THEN 1 ELSE 0 END) as win_rate",
            "COUNT(*) as total_trades"
          ],
          "from": "trading_signals",
          "group_by": "strategy, action",
          "having": "COUNT(*) >= 5",
          "order_by": "win_rate ASC"
        },
        "visualization": {
          "x_axis": "combination",
          "y_axis": "win_rate",
          "color": "win_rate",
          "highlight_condition": "win_rate < 0.3"
        }
      },
      {
        "id": "streak_analysis",
        "title": "Win/Loss Streak Analysis",
        "type": "scatter",
        "description": "แสดงความสัมพันธ์ระหว่าง win/loss streaks กับ win rate",
        "query": {
          "select": [
            "win_streak",
            "loss_streak",
            "AVG(CASE WHEN result_60min = 'WIN' THEN 1 ELSE 0 END) as win_rate",
            "COUNT(*) as total_trades"
          ],
          "from": "trading_signals",
          "group_by": "win_streak, loss_streak",
          "having": "COUNT(*) >= 3"
        },
        "visualization": {
          "x_axis": "win_streak",
          "y_axis": "loss_streak",
          "size": "total_trades",
          "color": "win_rate"
        }
      },
      {
        "id": "rolling_winrate_trend",
        "title": "Rolling Win Rate Trend",
        "type": "line",
        "description": "แสดง rolling win rate 10 และ 20 ครั้งล่าสุด - ใช้เป็น trend indicator",
        "query": {
          "select": [
            "entry_time",
            "rolling_win_rate_10",
            "rolling_win_rate_20",
            "AVG(CASE WHEN result_60min = 'WIN' THEN 1 ELSE 0 END) OVER (ORDER BY entry_time ROWS BETWEEN 9 PRECEDING AND CURRENT ROW) as actual_rolling_10",
            "AVG(CASE WHEN result_60min = 'WIN' THEN 1 ELSE 0 END) OVER (ORDER BY entry_time ROWS BETWEEN 19 PRECEDING AND CURRENT ROW) as actual_rolling_20"
          ],
          "from": "trading_signals",
          "order_by": "entry_time"
        },
        "visualization": {
          "x_axis": "entry_time",
          "y_axis": ["rolling_win_rate_10", "rolling_win_rate_20", "actual_rolling_10", "actual_rolling_20"],
          "line_types": ["solid", "dashed", "dotted", "dashdot"]
        }
      },
      {
        "id": "price_change_analysis",
        "title": "Price Change vs Win Rate",
        "type": "scatter",
        "description": "แสดงความสัมพันธ์ระหว่างการเปลี่ยนแปลงราคากับ win rate",
        "query": {
          "select": [
            "price_change_10min",
            "price_change_30min",
            "price_change_60min",
            "AVG(CASE WHEN result_60min = 'WIN' THEN 1 ELSE 0 END) as win_rate",
            "COUNT(*) as total_trades"
          ],
          "from": "trading_signals",
          "group_by": "price_change_10min, price_change_30min, price_change_60min",
          "having": "COUNT(*) >= 3"
        },
        "visualization": {
          "x_axis": "price_change_60min",
          "y_axis": "win_rate",
          "size": "total_trades",
          "color": "price_change_30min"
        }
      },
      {
        "id": "market_trend_analysis",
        "title": "Market Trend vs Win Rate",
        "type": "bar",
        "description": "แสดง win rate ตาม market trend",
        "query": {
          "select": [
            "market_trend",
            "AVG(CASE WHEN result_60min = 'WIN' THEN 1 ELSE 0 END) as win_rate",
            "COUNT(*) as total_trades"
          ],
          "from": "trading_signals",
          "group_by": "market_trend",
          "order_by": "market_trend"
        },
        "visualization": {
          "x_axis": "market_trend",
          "y_axis": "win_rate",
          "color": "win_rate"
        }
      },
      {
        "id": "day_of_week_analysis",
        "title": "Win Rate by Day of Week",
        "type": "bar",
        "description": "แสดง win rate ตามวันในสัปดาห์",
        "query": {
          "select": [
            "day_of_week",
            "AVG(CASE WHEN result_60min = 'WIN' THEN 1 ELSE 0 END) as win_rate",
            "COUNT(*) as total_trades"
          ],
          "from": "trading_signals",
          "group_by": "day_of_week",
          "order_by": "CASE day_of_week WHEN 'Monday' THEN 1 WHEN 'Tuesday' THEN 2 WHEN 'Wednesday' THEN 3 WHEN 'Thursday' THEN 4 WHEN 'Friday' THEN 5 WHEN 'Saturday' THEN 6 WHEN 'Sunday' THEN 7 END"
        },
        "visualization": {
          "x_axis": "day_of_week",
          "y_axis": "win_rate",
          "color": "win_rate"
        }
      }
    ],
    "alerts": [
      {
        "id": "high_volatility_alert",
        "title": "High Volatility Alert",
        "description": "แจ้งเตือนเมื่อ volatility level = 2 (0% win rate)",
        "condition": "volatility_level = 2",
        "message": "⚠️ HIGH VOLATILITY DETECTED - 100% Loss Rate Expected"
      },
      {
        "id": "bad_time_alert",
        "title": "Bad Trading Time Alert",
        "description": "แจ้งเตือนเมื่อเทรดในช่วงเวลา 17:00 (23.9% win rate)",
        "condition": "EXTRACT(HOUR FROM entry_time) = 17",
        "message": "⚠️ BAD TRADING TIME - 17:00 has only 23.9% win rate"
      },
      {
        "id": "good_time_alert",
        "title": "Good Trading Time Alert",
        "description": "แจ้งเตือนเมื่อเทรดในช่วงเวลา 02:00 (69.1% win rate)",
        "condition": "EXTRACT(HOUR FROM entry_time) = 2",
        "message": "✅ GOOD TRADING TIME - 02:00 has 69.1% win rate"
      }
    ],
    "filters": [
      {
        "id": "time_range_filter",
        "title": "Time Range",
        "type": "date_range",
        "field": "entry_time"
      },
      {
        "id": "strategy_filter",
        "title": "Strategy",
        "type": "dropdown",
        "field": "strategy"
      },
      {
        "id": "action_filter",
        "title": "Action",
        "type": "dropdown",
        "field": "action"
      },
      {
        "id": "volatility_filter",
        "title": "Volatility Level",
        "type": "dropdown",
        "field": "volatility_level"
      }
    ]
  },
  "sql_queries": {
    "create_table": "CREATE TABLE trading_signals AS SELECT * FROM (VALUES (1, '2025-09-03 15:26:04', 'BUY', 'EURUSD', 'MWP-27', '1m', 1.0850, 1.0855, 1.0860, 1.0865, 'WIN', 'WIN', 'WIN', 0.0005, '2025-09-03 15:36:04', '2025-09-03 15:56:04', '2025-09-03 16:26:04')) AS t(id, entry_time, action, symbol, strategy, tf, entry_price, price_10min, price_30min, price_60min, result_10min, result_30min, result_60min, pnl, price_10min_ts, price_30min_ts, price_60min_ts);",
    "insert_data": "INSERT INTO trading_signals SELECT * FROM csv_file('Result Last 120HR.csv');"
  },
  "setup_instructions": [
    "1. สร้าง table 'trading_signals' ใน Metabase",
    "2. Import ข้อมูลจาก CSV files",
    "3. สร้าง calculated fields สำหรับ volatility_level, market_trend, etc.",
    "4. สร้าง dashboard ตาม configuration นี้",
    "5. ตั้งค่า alerts ตามที่กำหนด",
    "6. ทดสอบ filters และ visualizations"
  ]
}
